{% extends './layout.html' %}

{% block title %}{{ data.titulo }}{% endblock %}

{% block header %}
{% include 'components/headerAlumno.html' %}
{% endblock %}

{% block body %}

<div class="main-page column-container">

    <div class="barra-lateral">
        <h4>{{expediente.nombre}}</h4>
        <h4>{{expediente.paterno}} {{expediente.materno}} </h4>
        <p><strong>Número de registro:</strong> {{expediente.numero}}</p>
        <p><strong>Boleta:</strong> {{expediente.boleta}}</p>
        <p><strong>Carrera:</strong> {{expediente.carrera}}</p>
        <p><strong>Prestatario:</strong> {{expediente.prestatario}}</p>
        <p><strong>Fecha Inicio:</strong> {{expediente.fecha_inicio}}</p>
        <p><strong>Fecha Término:</strong> {{expediente.fecha_termino}}</p>
        <p><strong>Correo electronico:</strong> {{expediente.correo}}</p>
        <p><strong>Fecha registro:</strong> {{expediente.fecha_registro}}</p>
        
    </div>
    <div class="contenido barra-central">
        <div class="row-container">
            <div>
                <h3>Expediente</h3>
                <p></p>
            </div>
        </div>
        <table>
            <tr>
                <th>#</th>
                <th>Documento</th>
                <th>Estado</th>
                <th>Fecha de envio</th>
                <th>Fecha de aceptado</th>
                <th></th>
            </tr>
            <tr class="item-table">
                <td class="centrar-texto">1</td>
                <td class="centrar-texto">{{ documentos[0]['tipo_documento'] }}</td>
                <td class="centrar-texto">{{ documentos[0]['status_documento'] }}</td>
                <td class="centrar-texto">{{ documentos[0]['fecha_envio'] }}</td>
                <td class="centrar-texto">{{ documentos[0]['fecha_aceptado'] }}</td>
                <td class="centrar-texto">
                    {% if documentos[0]['nombre_archivo'] %}
                    <a href="{{ url_for('verExpedientepdf', filename=documentos[0]['nombre_archivo']) }}" target="_blank">Visualizar</a>
                    {% endif %}
                </td>
            </tr>
            <tr class="item-table">
                <td class="centrar-texto">2</td>
                <td class="centrar-texto">{{ documentos[1]['tipo_documento'] }}</td>
                <td class="centrar-texto">{{ documentos[1]['status_documento'] }}</td>
                <td class="centrar-texto">{{ documentos[1]['fecha_envio'] }}</td>
                <td class="centrar-texto">{{ documentos[1]['fecha_aceptado'] }}</td>
                <td class="centrar-texto"><a href="">Visualizar</a></td>
            </tr>
            <tr class="item-table">
                <td class="centrar-texto">3</td>
                <td class="centrar-texto">{{ documentos[2]['tipo_documento'] }}</td>
                <td class="centrar-texto">{{ documentos[2]['status_documento'] }}</td>
                <td class="centrar-texto">{{ documentos[2]['fecha_envio'] }}</td>
                <td class="centrar-texto">{{ documentos[2]['fecha_aceptado'] }}</td>
                <td class="centrar-texto"><a href="">Visualizar</a></td>
            </tr>
            <tr class="item-table">
                <td class="centrar-texto">4</td>
                <td class="centrar-texto">{{ documentos[3]['tipo_documento'] }}</td>
                <td class="centrar-texto">{{ documentos[3]['status_documento'] }}</td>
                <td class="centrar-texto">{{ documentos[3]['fecha_envio'] }}</td>
                <td class="centrar-texto">{{ documentos[3]['fecha_aceptado'] }}</td>
                <td class="centrar-texto"><a href="">Visualizar</a></td>
            </tr>
        </table>
    </div>

</div>

{% set EXPEDIENTE = 1 %}
{% set EVALUACION_DESEMPENO  = 2 %}
{% set CARTA_TERMINO = 3 %}
{% set CONSTANCIA_LIBERACION = 4 %}

{% set SIN_ARCHIVO = 1 %}
{% set ACEPTADO = 2 %}
{% set ESPERA_APROBACION = 3 %}
{% set RECHAZADO = 4 %}



{% if expediente.espera == False %}
    {%if documentos[0]['id_tipo'] == EXPEDIENTE and (documentos[0]['id_status'] == SIN_ARCHIVO or documentos[0]['id_status'] == RECHAZADO)%}
        <div class="main-page">
            <div class="wrap-datos">
                <div id="idregistro">
                    <h1 class="titulo_Registro_sistema">Expediente</h1>
                    <div>
                        <h4> Suba su expediente en el siguiente apartado, y espere la validación de los administradores </h4>
                    </div>
                
                    <form action="/subir_expediente" method="post" enctype="multipart/form-data">
                        <div class="dp-campo_registro">
                            <div>
                                <label class="form-label">Expediente</label>
                                <div class="Idp-campo">
                                    <input id="documento" type="file" name="expediente" accept=".pdf" onchange="validarArchivo()" required >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo_registro" style="display: none;">
                            <div>
                                <div class="Idp-campo">
                                    <input type="hidden" name="id_doc" value="{{ documentos[0]['id_doc'] }}" >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo_registro" style="display: none;">
                            <div>
                                <div class="Idp-campo">
                                    <input type="hidden" name="id_status" value="{{ documentos[0]['id_status'] }}" >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo dp-Actual">
                            <label class="label_confirmacion" style="display: none;" >Fecha Actual </label>
                            <div class="Idp-campo">
                            <input  id="fecha_actual"name="Idp-Factual" type="date" placeholder="Fecha Actual" style="display: none;"/>
                            </div>   
                        </div>

                        <div id="error-message" style="display:none ;" class=" banner_error red no-margin no-padding dp-campo">
                            <p class="error-message"  > El archivo debe pesar menos de 3MB </p> 
                        </div>
        
                        <div class="dp-campo">
                            <div>
                                <label></label>
                                <div class="Idp-submit_registro">
                                    <input type="submit">
                                </div>   
                            </div>
                        </div>
                    </form>
                </div>
        
            </div>
        </div>
    {% endif %}

    {%if documentos[1]['id_tipo'] == EVALUACION_DESEMPENO and (documentos[1]['id_status'] == SIN_ARCHIVO or documentos[1]['id_status'] == RECHAZADO) and documentos[0]['id_status'] == ACEPTADO%}
        <div class="main-page">
            <div class="wrap-datos">
                <div id="idregistro">
                    <h1 class="titulo_Registro_sistema">EVALUACIÓN DE DESEMPEÑO</h1>
                    <div>
                        <h4> Suba su evaluación de desempeño en el siguiente apartado, y espere la validación de los administradores </h4>
                    </div>
                
                    <form action="/subir_evaluacion" method="post" enctype="multipart/form-data">
                        <div class="dp-campo_registro">
                            <div>
                                <label class="form-label">Evaluación de desempeño</label>
                                <div class="Idp-campo">
                                    <input id="documento" type="file" name="evaluacion" accept=".pdf" onchange="validarArchivo()" required >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo_registro" style="display: none;">
                            <div>
                                <div class="Idp-campo">
                                    <input type="hidden" name="id_doc" value="{{ documentos[1]['id_doc'] }}" >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo_registro" style="display: none;">
                            <div>
                                <div class="Idp-campo">
                                    <input type="hidden" name="id_status" value="{{ documentos[1]['id_status'] }}" >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo dp-Actual">
                            <label class="label_confirmacion" style="display: none;" >Fecha Actual </label>
                            <div class="Idp-campo">
                            <input  id="fecha_actual"name="Idp-Factual" type="date" placeholder="Fecha Actual" style="display: none;"/>
                            </div>   
                        </div>

                        <div id="error-message" style="display:none ;" class=" banner_error red no-margin no-padding dp-campo">
                            <p class="error-message"  > El archivo debe pesar menos de 3MB </p> 
                        </div>
        
                        <div class="dp-campo">
                            <div>
                                <label></label>
                                <div class="Idp-submit_registro">
                                    <input type="submit">
                                </div>   
                            </div>
                        </div>
                    </form>
                </div>
        
            </div>
        </div>
    {% endif %}

    {%if documentos[2]['id_tipo'] == CARTA_TERMINO and (documentos[2]['id_status'] == SIN_ARCHIVO or documentos[2]['id_status'] == RECHAZADO) and documentos[1]['id_status'] == ACEPTADO%}
        <div class="main-page">
            <div class="wrap-datos">
                <div id="idregistro">
                    <h1 class="titulo_Registro_sistema">CARTA TÉRMINO </h1>
                    <div>
                        <h4> Suba su carta término en el siguiente apartado, y espere la validación de los administradores </h4>
                    </div>
                
                    <form action="/subir_carta" method="post" enctype="multipart/form-data">
                        <div class="dp-campo_registro">
                            <div>
                                <label class="form-label">Carta término</label>
                                <div class="Idp-campo">
                                    <input id="documento" type="file" name="carta" accept=".pdf" onchange="validarArchivo()" required >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo_registro" style="display: none;">
                            <div>
                                <div class="Idp-campo">
                                    <input type="hidden" name="id_doc" value="{{ documentos[2]['id_doc'] }}" >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo_registro" style="display: none;">
                            <div>
                                <div class="Idp-campo">
                                    <input type="hidden" name="id_status" value="{{ documentos[2]['id_status'] }}" >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo dp-Actual">
                            <label class="label_confirmacion" style="display: none;" >Fecha Actual </label>
                            <div class="Idp-campo">
                            <input  id="fecha_actual"name="Idp-Factual" type="date" placeholder="Fecha Actual" style="display: none;"/>
                            </div>   
                        </div>

                        <div id="error-message" style="display:none ;" class=" banner_error red no-margin no-padding dp-campo">
                            <p class="error-message"  > El archivo debe pesar menos de 3MB </p> 
                        </div>
        
                        <div class="dp-campo">
                            <div>
                                <label></label>
                                <div class="Idp-submit_registro">
                                    <input type="submit">
                                </div>   
                            </div>
                        </div>
                    </form>
                </div>
        
            </div>
        </div>
    {% endif %}

    {%if documentos[3]['id_tipo'] == CONSTANCIA_LIBERACION and (documentos[3]['id_status'] == SIN_ARCHIVO or documentos[3]['id_status'] == RECHAZADO) and documentos[2]['id_status'] == ACEPTADO%}
        <div class="main-page">
            <div class="wrap-datos">
                <div id="idregistro">
                    <h1 class="titulo_Registro_sistema">CONSTANCIA DE LIBERACIÓN </h1>
                    <div>
                        <h4> Suba su constacia de liberación en el siguiente apartado, y espere la validación de los administradores </h4>
                    </div>
                
                    <form action="/subir_constancia" method="post" enctype="multipart/form-data">
                        <div class="dp-campo_registro">
                            <div>
                                <label class="form-label">Constacia de liberación</label>
                                <div class="Idp-campo">
                                    <input id="documento" type="file" name="constancia" accept=".pdf" onchange="validarArchivo()" required >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo_registro" style="display: none;">
                            <div>
                                <div class="Idp-campo">
                                    <input type="hidden" name="id_doc" value="{{ documentos[3]['id_doc'] }}" >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo_registro" style="display: none;">
                            <div>
                                <div class="Idp-campo">
                                    <input type="hidden" name="id_status" value="{{ documentos[3]['id_status'] }}" >
                                </div>
                            </div>
                        </div>

                        <div class="dp-campo dp-Actual">
                            <label class="label_confirmacion" style="display: none;" >Fecha Actual </label>
                            <div class="Idp-campo">
                            <input  id="fecha_actual"name="Idp-Factual" type="date" placeholder="Fecha Actual" style="display: none;"/>
                            </div>   
                        </div>

                        <div id="error-message" style="display:none ;" class=" banner_error red no-margin no-padding dp-campo">
                            <p class="error-message"  > El archivo debe pesar menos de 3MB </p> 
                        </div>
        
                        <div class="dp-campo">
                            <div>
                                <label></label>
                                <div class="Idp-submit_registro">
                                    <input type="submit">
                                </div>   
                            </div>
                        </div>
                    </form>
                </div>
        
            </div>
        </div>
    {% endif %}
{% else %}
    <div class="main-page">
        <div class="wrap-datos">
            <div id="idregistro">
                <h1 class="titulo_Registro_sistema">ESPERE VALIDACIÓN</h1>
                <div>
                    <h4> Espere a que un administrador revise su documento </h4>
                </div>
            </div>

        </div>
    </div>
{% endif %}


<script>

function validarArchivo() 
{
  const fileInput = document.getElementById('documento');
  const errorMessage = document.getElementById('error-message');
  const maxFileSize = 3 * 1024 * 1024; // 3 MB

  errorMessage.style.display="none";
  
  if (fileInput.files[0].size > maxFileSize) 
  {
    errorMessage.style.display="block";
    fileInput.value = '';
  } 
}

</script>

<script>
    const hoy = new Date();
    const zona_horaria = -300; // en minutos
    const offset = hoy.getTimezoneOffset();
    hoy.setMinutes(hoy.getMinutes() + offset + zona_horaria);
    const fecha_formateada = hoy.toISOString().substr(0, 10);
    document.getElementById("fecha_actual").value = fecha_formateada;
  </script>

{% endblock %}